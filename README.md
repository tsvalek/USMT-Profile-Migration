# USMT Profile Migration Tool — Инструкция

## Быстрый старт

### 1. Установка USMT

1. Скачайте [Windows ADK для Windows 11](https://learn.microsoft.com/en-us/windows-hardware/get-started/adk-install)
2. При установке выберите только **"User State Migration Tool (USMT)"**
3. После установки скопируйте содержимое папки:
   ```
   C:\Program Files (x86)\Windows Kits\10\Assessment and Deployment Kit\User State Migration Tool\amd64\
   ```
   в:
   ```
   \\truenas\Share\Profiles\Tools\USMT\amd64\
   ```

### 2. Структура папок

После настройки структура должна выглядеть так:

```
\\truenas\Share\Profiles\
├── Tools\
│   ├── USMT\
│   │   └── amd64\
│   │       ├── scanstate.exe      ← Обязательно
│   │       ├── loadstate.exe      ← Обязательно
│   │       ├── migapp.xml         ← Обязательно
│   │       ├── migdocs.xml        ← Обязательно
│   │       ├── miguser.xml        ← Обязательно
│   │       └── ... (остальные файлы)
│   ├── Config\
│   │   └── MigExclude.xml         ← Исключения мусора
│   ├── Migrate.cmd                ← Точка запуска
│   └── Migrate.ps1                ← Основной скрипт
│
└── (здесь будут папки с профилями)
```

### 3. Использование

#### Экспорт профиля (на старом ПК):

1. Запустите `\\truenas\Share\Profiles\Tools\Migrate.cmd` **от имени администратора**
2. Выберите пункт **1 — Экспорт профиля**
3. Выберите нужного пользователя из списка
4. Дождитесь завершения

#### Импорт профиля (на новом ПК):

1. Запустите `\\truenas\Share\Profiles\Tools\Migrate.cmd` **от имени администратора**
2. Выберите пункт **2 — Импорт профиля**
3. Выберите профиль из списка
4. Подтвердите импорт
5. **Перезагрузите компьютер** после завершения

---

## Что переносится

### ✅ Переносится:
- Рабочий стол, Документы, Загрузки, Изображения, Видео, Музыка
- Настройки браузеров (закладки, пароли, расширения)
- Подписи и настройки Outlook
- Настройки приложений (AppData)
- Сохранённые сети Wi-Fi
- Настройки принтеров
- Подключённые сетевые диски

### ❌ НЕ переносится (исключено):
- Кэш браузеров (Chrome, Firefox, Edge, Opera, Brave)
- Временные файлы Windows
- Кэш приложений (Spotify, Discord, Teams, VS Code, Telegram)
- Корзина
- Thumbs.db, desktop.ini
- Файлы *.tmp, *.dmp
- Windows Update кэш

---

## Коды возврата USMT

| Код | Значение |
|-----|----------|
| 0   | Успешно |
| 2   | Некоторые файлы пропущены (не критично) |
| 3   | Некоторые параметры не применены |
| >3  | Ошибка — проверьте лог |

---

## Устранение неполадок

### Ошибка: "USMT не найден"
Убедитесь, что файлы USMT скопированы в `Tools\USMT\amd64\`

### Ошибка: "Требуются права администратора"
Запустите `Migrate.cmd` правой кнопкой → "Запуск от имени администратора"

### Ошибка подключения к сетевой папке
- Проверьте доступность `\\truenas\Share\Profiles`
- Для не-доменных ПК учётные данные вводятся автоматически

### Логи
Все логи сохраняются в папке профиля:
- `migration.log` — общий лог
- `scanstate.log` — лог экспорта (детальный)
- `loadstate.log` — лог импорта (детальный)
